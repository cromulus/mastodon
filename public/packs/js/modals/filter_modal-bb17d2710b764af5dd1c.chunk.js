(window.webpackJsonp=window.webpackJsonp||[]).push([[584],{1272:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a(2),l=a.n(i),o=a(7),d=a(21),r=a(43),c=a(18),n=a(10),h=a(35),p=a(162),u=a(27),m=a(24),_=a(1),b=a(26),g=a(286),f=a(4);class j extends _.PureComponent{constructor(){super(...arguments),this.handleCloseClick=()=>{const{onClose:e}=this.props;e()}}render(){const{filter:e,contextType:t}=this.props;let a=null;e.get("expires_at")&&e.get("expires_at")<new Date&&(a=Object(f.jsxs)(f.Fragment,{children:[Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.expired_title",defaultMessage:"Expired filter!"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.expired_explanation",defaultMessage:"This filter category has expired, you will need to change the expiration date for it to apply."}))]}));let i=null;t&&!e.get("context").includes(Object(g.a)(t))&&(i=Object(f.jsxs)(f.Fragment,{children:[Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.context_mismatch_title",defaultMessage:"Context mismatch!"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.context_mismatch_explanation",defaultMessage:"This filter category does not apply to the context in which you have accessed this post. If you want the post to be filtered in this context too, you will have to edit the filter."}))]}));const l=Object(s.a)("a",{href:`/filters/${e.get("id")}/edit`},void 0,Object(s.a)(d.a,{id:"filter_modal.added.settings_link",defaultMessage:"settings page"}));return Object(f.jsxs)(f.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.title",defaultMessage:"Filter added!"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.short_explanation",defaultMessage:"This post has been added to the following filter category: {title}.",values:{title:e.get("title")}})),a,i,Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.review_and_configure_title",defaultMessage:"Filter settings"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(d.a,{id:"filter_modal.added.review_and_configure",defaultMessage:"To review and further configure this filter category, go to the {settings_link}.",values:{settings_link:l}})),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(b.a,{onClick:this.handleCloseClick},void 0,Object(s.a)(d.a,{id:"report.close",defaultMessage:"Done"})))]})}}var O=Object(n.connect)(((e,t)=>{let{filterId:a}=t;return{filter:e.getIn(["filters",a])}}))(j),w=a(168),N=a(333),v=a.n(N),x=a(15),y=a(259);const C=Object(o.d)({search:{id:"filter_modal.select_filter.search",defaultMessage:"Search or create"},clear:{id:"emoji_button.clear",defaultMessage:"Clear"}});class k extends _.PureComponent{constructor(){super(...arguments),this.state={searchValue:""},this.renderItem=e=>{let t=null;return(e[3]||e[4])&&(t=Object(s.a)("span",{className:"language-dropdown__dropdown__results__item__common-name"},void 0,"(",e[3]&&Object(s.a)(d.a,{id:"filter_modal.select_filter.expired",defaultMessage:"expired"}),e[3]&&e[4]&&", ",e[4]&&Object(s.a)(d.a,{id:"filter_modal.select_filter.context_mismatch",defaultMessage:"does not apply to this context"}),")")),Object(s.a)("div",{role:"button",tabIndex:0,"data-index":e[0],className:"language-dropdown__dropdown__results__item",onClick:this.handleItemClick,onKeyDown:this.handleKeyDown},e[0],Object(s.a)("span",{className:"language-dropdown__dropdown__results__item__native-name"},void 0,e[1])," ",t)},this.handleSearchChange=e=>{let{target:t}=e;this.setState({searchValue:t.value})},this.setListRef=e=>{this.listNode=e},this.handleKeyDown=e=>{const t=Array.from(this.listNode.childNodes).findIndex((t=>t===e.currentTarget));let a=null;switch(e.key){case" ":case"Enter":e.currentTarget.click();break;case"ArrowDown":a=this.listNode.childNodes[t+1]||this.listNode.firstChild;break;case"ArrowUp":a=this.listNode.childNodes[t-1]||this.listNode.lastChild;break;case"Tab":a=e.shiftKey?this.listNode.childNodes[t-1]||this.listNode.lastChild:this.listNode.childNodes[t+1]||this.listNode.firstChild;break;case"Home":a=this.listNode.firstChild;break;case"End":a=this.listNode.lastChild}a&&(a.focus(),e.preventDefault(),e.stopPropagation())},this.handleSearchKeyDown=e=>{let t=null;switch(e.key){case"Tab":case"ArrowDown":t=this.listNode.firstChild,t&&(t.focus(),e.preventDefault(),e.stopPropagation())}},this.handleClear=()=>{this.setState({searchValue:""})},this.handleItemClick=e=>{const t=e.currentTarget.getAttribute("data-index");e.preventDefault(),this.props.onSelectFilter(t)},this.handleNewFilterClick=e=>{e.preventDefault(),this.props.onNewFilter(this.state.searchValue)}}search(){const{filters:e}=this.props,{searchValue:t}=this.state;return""===t?e:v.a.go(t,e,{keys:["1","2"],limit:5,threshold:-1e4}).map((e=>e.obj))}renderCreateNew(e){return Object(s.a)("div",{role:"button",tabIndex:0,className:"language-dropdown__dropdown__results__item",onClick:this.handleNewFilterClick,onKeyDown:this.handleKeyDown},"add-new-filter",Object(s.a)(x.a,{id:"plus",icon:w.a})," ",Object(s.a)(d.a,{id:"filter_modal.select_filter.prompt_new",defaultMessage:"New category: {name}",values:{name:e}}))}render(){const{intl:e}=this.props,{searchValue:t}=this.state,a=""!==t,i=this.search();return Object(f.jsxs)(f.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(d.a,{id:"filter_modal.select_filter.title",defaultMessage:"Filter this post"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(d.a,{id:"filter_modal.select_filter.subtitle",defaultMessage:"Use an existing category or create a new one"})),Object(s.a)("div",{className:"emoji-mart-search"},void 0,Object(s.a)("input",{type:"search",value:t,onChange:this.handleSearchChange,onKeyDown:this.handleSearchKeyDown,placeholder:e.formatMessage(C.search),autoFocus:!0}),Object(s.a)("button",{type:"button",className:"emoji-mart-search-icon",disabled:!a,"aria-label":e.formatMessage(C.clear),onClick:this.handleClear},void 0,a?y.a:y.b)),Object(f.jsxs)("div",{className:"language-dropdown__dropdown__results emoji-mart-scroll",role:"listbox",ref:this.setListRef,children:[i.map(this.renderItem),a&&this.renderCreateNew(t)]})]})}}var S=Object(n.connect)(((e,t)=>{let{contextType:a}=t;return{filters:Array.from(e.get("filters").values()).map((e=>{var t;return[e.get("id"),e.get("title"),null==(t=e.get("keywords"))?void 0:t.map((e=>e.get("keyword"))).join("\n"),e.get("expires_at")&&e.get("expires_at")<new Date,a&&!e.get("context").includes(Object(g.a)(a))]}))}}))(Object(r.c)(k));const F=Object(o.d)({close:{id:"lightbox.close",defaultMessage:"Close"}});class M extends c.a{constructor(){super(...arguments),this.state={step:"select",filterId:null,isSubmitting:!1,isSubmitted:!1},this.handleNewFilterSuccess=e=>{this.handleSelectFilter(e.id)},this.handleSuccess=()=>{const{dispatch:e,statusId:t}=this.props;e(Object(u.n)(t,!0)),this.setState({isSubmitting:!1,isSubmitted:!0,step:"submitted"})},this.handleFail=()=>{this.setState({isSubmitting:!1})},this.handleNextStep=e=>{this.setState({step:e})},this.handleSelectFilter=e=>{const{dispatch:t,statusId:a}=this.props;this.setState({isSubmitting:!0,filterId:e}),t(Object(p.d)({filter_id:e,status_id:a},this.handleSuccess,this.handleFail))},this.handleNewFilter=e=>{const{dispatch:t}=this.props;this.setState({isSubmitting:!0}),t(Object(p.c)({title:e,context:["home","notifications","public","thread","account"],action:"warn"},this.handleNewFilterSuccess,this.handleFail))}}componentDidMount(){const{dispatch:e}=this.props;e(Object(p.e)())}render(){const{intl:e,statusId:t,contextType:a,onClose:i}=this.props,{step:l,filterId:o}=this.state;let r;switch(l){case"select":r=Object(s.a)(S,{contextType:a,onSelectFilter:this.handleSelectFilter,onNewFilter:this.handleNewFilter});break;case"create":r=null;break;case"submitted":r=Object(s.a)(O,{contextType:a,filterId:o,statusId:t,onClose:i})}return Object(s.a)("div",{className:"modal-root__modal report-dialog-modal"},void 0,Object(s.a)("div",{className:"report-modal__target"},void 0,Object(s.a)(m.a,{className:"report-modal__close",title:e.formatMessage(F.close),icon:"times",iconComponent:h.a,onClick:i,size:20}),Object(s.a)(d.a,{id:"filter_modal.title.status",defaultMessage:"Filter a post"})),Object(s.a)("div",{className:"report-dialog-modal__container"},void 0,r))}}M.propTypes={statusId:l.a.string.isRequired,contextType:l.a.string,dispatch:l.a.func.isRequired,intl:l.a.object.isRequired};t.default=Object(n.connect)()(Object(r.c)(M))}}]);
//# sourceMappingURL=filter_modal-bb17d2710b764af5dd1c.chunk.js.map