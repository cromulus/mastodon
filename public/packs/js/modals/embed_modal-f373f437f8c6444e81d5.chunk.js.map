{"version":3,"sources":["webpack:///./app/javascript/mastodon/features/ui/components/embed_modal.jsx"],"names":["messages","defineMessages","close","id","defaultMessage","EmbedModal","ImmutablePureComponent","constructor","arguments","_defineProperty","loading","oembed","c","this","iframe","e","target","select","componentDidMount","props","setState","api","get","then","res","data","iframeDocument","contentWindow","document","open","write","html","body","style","margin","width","scrollWidth","height","scrollHeight","catch","error","onError","render","intl","onClose","state","_jsx","className","IconButton","title","formatMessage","icon","iconComponent","CloseIcon","onClick","size","FormattedMessage","display","type","readOnly","value","handleTextareaClick","_jsx2","frameBorder","ref","setIframeRef","sandbox","PropTypes","string","isRequired","func","object","injectIntl"],"mappings":"mMAWA,MAAMA,EAAWC,YAAe,CAC9BC,MAAO,CAAEC,GAAG,iBAAmBC,eAAe,WAGhD,MAAMC,UAAmBC,IAAuBC,cAAA,SAAAC,WAAAC,YAAA,aAStC,CACNC,SAAS,EACTC,OAAQ,OACTF,YAAA,qBAwBcG,IACbC,KAAKC,OAASF,CAAC,IAChBH,YAAA,4BAEsBM,IACrBA,EAAEC,OAAOC,QAAQ,GAClB,CA5BDC,oBACE,MAAM,GAAEf,GAAOU,KAAKM,MAEpBN,KAAKO,SAAS,CAAEV,SAAS,IAEzBW,cAAMC,IAAK,mBAAkBnB,KAAMoB,MAAKC,IACtCX,KAAKO,SAAS,CAAEV,SAAS,EAAOC,OAAQa,EAAIC,OAE5C,MAAMC,EAAiBb,KAAKC,OAAOa,cAAcC,SAEjDF,EAAeG,OACfH,EAAeI,MAAMN,EAAIC,KAAKM,MAC9BL,EAAexB,QAEfwB,EAAeM,KAAKC,MAAMC,OAAS,EACnCrB,KAAKC,OAAOqB,MAAST,EAAeM,KAAKI,YACzCvB,KAAKC,OAAOuB,OAASX,EAAeM,KAAKM,YAAY,IACpDC,OAAMC,IACP3B,KAAKM,MAAMsB,QAAQD,EAAM,GAE7B,CAUAE,SACE,MAAM,KAAEC,EAAI,QAAEC,GAAY/B,KAAKM,OACzB,OAAER,GAAWE,KAAKgC,MAExB,OACEC,YAAA,OAAKC,UAAU,mDAA4C,EACzDD,YAAA,OAAKC,UAAU,6BAAsB,EACnCD,YAACE,IAAU,CAACD,UAAU,qBAAqBE,MAAON,EAAKO,cAAclD,EAASE,OAAQiD,KAAK,QAAQC,cAAeC,IAAWC,QAASV,EAASW,KAAM,KACrJT,YAACU,IAAgB,CAACrD,GAAE,eAAgBC,eAAe,WAGrD0C,YAAA,OAAKC,UAAU,iDAAiDd,MAAO,CAAEwB,QAAS,eAAU,EAC1FX,YAAA,KAAGC,UAAU,aAAM,EACjBD,YAACU,IAAgB,CAACrD,GAAE,qBAAsBC,eAAe,kEAG3D0C,YAAA,SACEY,KAAK,OACLX,UAAU,oBACVY,UAAQ,EACRC,MAAOjD,GAAUA,EAAOoB,MAAQ,GAChCuB,QAASzC,KAAKgD,sBAGhBf,YAAA,KAAGC,UAAU,aAAM,EACjBD,YAACU,IAAgB,CAACrD,GAAE,gBAAiBC,eAAe,qCAGtD0D,cAAA,UACEf,UAAU,sBACVgB,YAAY,IACZC,IAAKnD,KAAKoD,aACVC,QAAQ,kCACRjB,MAAM,aAKhB,EAEDxC,YApFKJ,EAAU,YAEK,CACjBF,GAAIgE,IAAUC,OAAOC,WACrBzB,QAASuB,IAAUG,KAAKD,WACxB5B,QAAS0B,IAAUG,KAAKD,WACxB1B,KAAMwB,IAAUI,OAAOF,aAgFZG,sBAAWnE,E","file":"js/modals/embed_modal-f373f437f8c6444e81d5.chunk.js","sourcesContent":["import PropTypes from 'prop-types';\n\nimport { defineMessages, FormattedMessage, injectIntl } from 'react-intl';\n\nimport ImmutablePureComponent from 'react-immutable-pure-component';\n\nimport { ReactComponent as CloseIcon } from '@material-symbols/svg-600/outlined/close.svg';\n\nimport api from 'mastodon/api';\nimport { IconButton } from 'mastodon/components/icon_button';\n\nconst messages = defineMessages({\n  close: { id: 'lightbox.close', defaultMessage: 'Close' },\n});\n\nclass EmbedModal extends ImmutablePureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    onClose: PropTypes.func.isRequired,\n    onError: PropTypes.func.isRequired,\n    intl: PropTypes.object.isRequired,\n  };\n\n  state = {\n    loading: false,\n    oembed: null,\n  };\n\n  componentDidMount () {\n    const { id } = this.props;\n\n    this.setState({ loading: true });\n\n    api().get(`/api/web/embeds/${id}`).then(res => {\n      this.setState({ loading: false, oembed: res.data });\n\n      const iframeDocument = this.iframe.contentWindow.document;\n\n      iframeDocument.open();\n      iframeDocument.write(res.data.html);\n      iframeDocument.close();\n\n      iframeDocument.body.style.margin = 0;\n      this.iframe.width  = iframeDocument.body.scrollWidth;\n      this.iframe.height = iframeDocument.body.scrollHeight;\n    }).catch(error => {\n      this.props.onError(error);\n    });\n  }\n\n  setIframeRef = c =>  {\n    this.iframe = c;\n  };\n\n  handleTextareaClick = (e) => {\n    e.target.select();\n  };\n\n  render () {\n    const { intl, onClose } = this.props;\n    const { oembed } = this.state;\n\n    return (\n      <div className='modal-root__modal report-modal embed-modal'>\n        <div className='report-modal__target'>\n          <IconButton className='media-modal__close' title={intl.formatMessage(messages.close)} icon='times' iconComponent={CloseIcon} onClick={onClose} size={16} />\n          <FormattedMessage id='status.embed' defaultMessage='Embed' />\n        </div>\n\n        <div className='report-modal__container embed-modal__container' style={{ display: 'block' }}>\n          <p className='hint'>\n            <FormattedMessage id='embed.instructions' defaultMessage='Embed this status on your website by copying the code below.' />\n          </p>\n\n          <input\n            type='text'\n            className='embed-modal__html'\n            readOnly\n            value={oembed && oembed.html || ''}\n            onClick={this.handleTextareaClick}\n          />\n\n          <p className='hint'>\n            <FormattedMessage id='embed.preview' defaultMessage='Here is what it will look like:' />\n          </p>\n\n          <iframe\n            className='embed-modal__iframe'\n            frameBorder='0'\n            ref={this.setIframeRef}\n            sandbox='allow-scripts allow-same-origin'\n            title='preview'\n          />\n        </div>\n      </div>\n    );\n  }\n\n}\n\nexport default injectIntl(EmbedModal);\n"],"sourceRoot":""}