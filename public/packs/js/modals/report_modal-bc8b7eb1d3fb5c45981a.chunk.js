(window.webpackJsonp=window.webpackJsonp||[]).push([[587],{1258:function(e,t,a){"use strict";a.r(t);var s=a(0),o=a(2),l=a.n(o),i=a(7),c=a(21),d=a(43),r=a(3),n=a(16),u=a.n(n),g=a(18),p=a(10),h=a(35),b=a(173),m=a(50),j=a(22),O=a(24),v=a(1),_=a(26),f=a(1120),k=a(4);const y=Object(i.d)({dislike:{id:"report.reasons.dislike",defaultMessage:"I don't like it"},dislike_description:{id:"report.reasons.dislike_description",defaultMessage:"It is not something you want to see"},spam:{id:"report.reasons.spam",defaultMessage:"It's spam"},spam_description:{id:"report.reasons.spam_description",defaultMessage:"Malicious links, fake engagement, or repetitive replies"},legal:{id:"report.reasons.legal",defaultMessage:"It's illegal"},legal_description:{id:"report.reasons.legal_description",defaultMessage:"You believe it violates the law of your or the server's country"},violation:{id:"report.reasons.violation",defaultMessage:"It violates server rules"},violation_description:{id:"report.reasons.violation_description",defaultMessage:"You are aware that it breaks specific rules"},other:{id:"report.reasons.other",defaultMessage:"It's something else"},other_description:{id:"report.reasons.other_description",defaultMessage:"The issue does not fit into other categories"},status:{id:"report.category.title_status",defaultMessage:"post"},account:{id:"report.category.title_account",defaultMessage:"profile"}});class C extends v.PureComponent{constructor(){super(...arguments),this.handleNextClick=()=>{const{onNextStep:e,category:t}=this.props;switch(t){case"dislike":e("thanks");break;case"violation":e("rules");break;default:e("statuses")}},this.handleCategoryToggle=(e,t)=>{const{onChangeCategory:a}=this.props;t&&a(e)}}render(){const{category:e,startedFrom:t,rules:a,intl:o}=this.props,l=a.size>0?["dislike","spam","legal","violation","other"]:["dislike","spam","legal","other"];return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.category.title",defaultMessage:"Tell us what's going on with this {type}",values:{type:o.formatMessage(y[t])}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.category.subtitle",defaultMessage:"Choose the best match"})),Object(s.a)("div",{},void 0,l.map((t=>Object(s.a)(f.a,{name:"category",value:t,checked:e===t,onToggle:this.handleCategoryToggle,label:o.formatMessage(y[t]),description:o.formatMessage(y[`${t}_description`])},t)))),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleNextClick,disabled:null===e},void 0,Object(s.a)(c.a,{id:"report.next",defaultMessage:"Next"})))]})}}var S=Object(p.connect)((e=>({rules:e.getIn(["server","server","rules"],Object(r.List)())})))(Object(d.c)(C)),M=a(79),N=a(36),x=a(278),w=a.n(x),I=a(9),T=a(66);const R=Object(i.d)({placeholder:{id:"report.placeholder",defaultMessage:"Type or paste additional comments"}}),D=Object(N.a)([e=>e.get("statuses"),(e,t)=>t],((e,t)=>t.map((t=>e.getIn([t,"in_reply_to_account_id"])))),{resultEqualityCheck:p.shallowEqual});var F=e=>{let{comment:t,domain:a,statusIds:o,isRemote:l,isSubmitting:i,selectedDomains:d,onSubmit:n,onChangeComment:u,onToggleDomain:g}=e;const p=Object(M.a)(),h=Object(T.b)(),b=Object(v.useRef)(!1),m=Object(v.useCallback)((()=>n()),[n]),j=Object(v.useCallback)((e=>u(e.target.value)),[u]),O=Object(v.useCallback)((e=>g(e.target.value,e.target.checked)),[g]),f=Object(v.useCallback)((e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey)&&m()}),[m]),y=Object(T.c)((e=>a?D(e,o):Object(r.List)())),C=Object(T.c)((e=>e.get("accounts"))),S=a?Object(r.OrderedSet)([a]).union(y.map((e=>C.getIn([e,"acct"],"").split("@")[1])).filter((e=>!!e))):Object(r.OrderedSet)();return Object(v.useEffect)((()=>{if(b.current)return;b.current=!0,S.forEach((e=>{g(e,!0)}));Object(r.OrderedSet)(y.filter((e=>e&&!C.has(e)))).forEach((e=>{h(Object(I.O)(e))}))})),Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.comment.title",defaultMessage:"Is there anything else you think we should know?"})),Object(s.a)("textarea",{className:"report-dialog-modal__textarea",placeholder:p.formatMessage(R.placeholder),value:t,onChange:j,onKeyDown:f,disabled:i}),l&&Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.forward_hint",defaultMessage:"The account is from another server. Send an anonymized copy of the report there as well?"})),S.map((e=>Object(s.a)("label",{className:"report-dialog-modal__toggle"},`toggle-${e}`,Object(s.a)(w.a,{checked:d.includes(e),disabled:i,onChange:O,value:e}),Object(s.a)(c.a,{id:"report.forward",defaultMessage:"Forward to {target}",values:{target:e}}))))]}),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:m,disabled:i},void 0,Object(s.a)(c.a,{id:"report.submit",defaultMessage:"Submit report"})))]})};class q extends v.PureComponent{constructor(){super(...arguments),this.handleNextClick=()=>{const{onNextStep:e}=this.props;e("statuses")},this.handleRulesToggle=(e,t)=>{const{onToggle:a}=this.props;a(e,t)}}render(){const{rules:e,selectedRuleIds:t}=this.props;return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.rules.title",defaultMessage:"Which rules are being violated?"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.rules.subtitle",defaultMessage:"Select all that apply"})),Object(s.a)("div",{},void 0,e.map((e=>Object(s.a)(f.a,{name:"rule_ids",value:e.get("id"),checked:t.includes(e.get("id")),onToggle:this.handleRulesToggle,label:e.get("text"),multiple:!0},e.get("id"))))),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleNextClick,disabled:t.size<1},void 0,Object(s.a)(c.a,{id:"report.next",defaultMessage:"Next"})))]})}}var z=Object(p.connect)((e=>({rules:e.getIn(["server","server","rules"])})))(q),B=a(165),E=a(38),L=a(39),P=a(53),Y=a(1131),A=a(77),K=a(131),U=a(183);class $ extends v.PureComponent{constructor(){super(...arguments),this.handleStatusesToggle=(e,t)=>{const{onToggle:a}=this.props;a(e,t)}}render(){const{status:e,checked:t}=this.props;if(e.get("reblog"))return null;const a=Object(s.a)("div",{className:"status-check-box__status poll__option__text"},void 0,Object(s.a)("div",{className:"detailed-status__display-name"},void 0,Object(s.a)("div",{className:"detailed-status__display-avatar"},void 0,Object(s.a)(L.a,{account:e.get("account"),size:46})),Object(s.a)("div",{},void 0,Object(s.a)(P.a,{account:e.get("account")})," Â· ",Object(s.a)("span",{className:"status__visibility-icon"},void 0,Object(s.a)(U.a,{visibility:e.get("visibility")}))," ",Object(s.a)(A.a,{timestamp:e.get("created_at")}))),Object(s.a)(K.a,{status:e}),Object(s.a)(Y.a,{status:e}));return Object(s.a)(f.a,{name:"status_ids",value:e.get("id"),checked:t,onToggle:this.handleStatusesToggle,label:e.get("search_index"),labelComponent:a,multiple:!0})}}var J=$;var W=Object(p.connect)((()=>{const e=Object(E.i)();return(t,a)=>{let{id:s}=a;return{status:e(t,{id:s})}}}))(J);class H extends v.PureComponent{constructor(){super(...arguments),this.handleNextClick=()=>{const{onNextStep:e}=this.props;e("comment")}}render(){const{availableStatusIds:e,selectedStatusIds:t,onToggle:a,isLoading:o}=this.props;return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(c.a,{id:"report.statuses.title",defaultMessage:"Are there any posts that back up this report?"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.statuses.subtitle",defaultMessage:"Select all that apply"})),Object(s.a)("div",{className:"report-dialog-modal__statuses"},void 0,o?Object(s.a)(B.a,{}):e.union(t).map((e=>Object(s.a)(W,{id:e,checked:t.includes(e),onToggle:a},e)))),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleNextClick},void 0,Object(s.a)(c.a,{id:"report.next",defaultMessage:"Next"})))]})}}var V=Object(p.connect)(((e,t)=>{let{accountId:a}=t;return{availableStatusIds:Object(r.OrderedSet)(e.getIn(["timelines",`account:${a}:with_replies`,"items"])),isLoading:e.getIn(["timelines",`account:${a}:with_replies`,"isLoading"])}}))(H);class G extends v.PureComponent{constructor(){super(...arguments),this.handleCloseClick=()=>{const{onClose:e}=this.props;e()},this.handleUnfollowClick=()=>{const{dispatch:e,account:t,onClose:a}=this.props;e(Object(I.ab)(t.get("id"))),a()},this.handleMuteClick=()=>{const{dispatch:e,account:t,onClose:a}=this.props;e(Object(I.V)(t.get("id"))),a()},this.handleBlockClick=()=>{const{dispatch:e,account:t,onClose:a}=this.props;e(Object(I.K)(t.get("id"))),a()}}render(){const{account:e,submitted:t}=this.props;return Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,t?Object(s.a)(c.a,{id:"report.thanks.title_actionable",defaultMessage:"Thanks for reporting, we'll look into this."}):Object(s.a)(c.a,{id:"report.thanks.title",defaultMessage:"Don't want to see this?"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,t?Object(s.a)(c.a,{id:"report.thanks.take_action_actionable",defaultMessage:"While we review this, you can take action against @{name}:",values:{name:e.get("username")}}):Object(s.a)(c.a,{id:"report.thanks.take_action",defaultMessage:"Here are your options for controlling what you see on Mastodon:"})),e.getIn(["relationship","following"])&&Object(k.jsxs)(k.Fragment,{children:[Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(c.a,{id:"report.unfollow",defaultMessage:"Unfollow @{name}",values:{name:e.get("username")}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.unfollow_explanation",defaultMessage:"You are following this account. To not see their posts in your home feed anymore, unfollow them."})),Object(s.a)(_.a,{secondary:!0,onClick:this.handleUnfollowClick},void 0,Object(s.a)(c.a,{id:"account.unfollow",defaultMessage:"Unfollow"})),Object(s.a)("hr",{})]}),Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(c.a,{id:"account.mute",defaultMessage:"Mute @{name}",values:{name:e.get("username")}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.mute_explanation",defaultMessage:"You will not see their posts. They can still follow you and see your posts and will not know that they are muted."})),Object(s.a)(_.a,{secondary:!0,onClick:this.handleMuteClick},void 0,e.getIn(["relationship","muting"])?Object(s.a)(c.a,{id:"account.muted",defaultMessage:"Muted"}):Object(s.a)(c.a,{id:"report.mute",defaultMessage:"Mute"})),Object(s.a)("hr",{}),Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(c.a,{id:"account.block",defaultMessage:"Block @{name}",values:{name:e.get("username")}})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(c.a,{id:"report.block_explanation",defaultMessage:"You will not see their posts. They will not be able to see your posts or follow you. They will be able to tell that they are blocked."})),Object(s.a)(_.a,{secondary:!0,onClick:this.handleBlockClick},void 0,e.getIn(["relationship","blocking"])?Object(s.a)(c.a,{id:"account.blocked",defaultMessage:"Blocked"}):Object(s.a)(c.a,{id:"report.block",defaultMessage:"Block"})),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(_.a,{onClick:this.handleCloseClick},void 0,Object(s.a)(c.a,{id:"report.close",defaultMessage:"Done"})))]})}}var Q=Object(p.connect)((()=>({})))(G);const X=Object(i.d)({close:{id:"lightbox.close",defaultMessage:"Close"}});class Z extends g.a{constructor(){super(...arguments),this.state={step:"category",selectedStatusIds:Object(r.OrderedSet)(this.props.statusId?[this.props.statusId]:[]),selectedDomains:Object(r.OrderedSet)(),comment:"",category:null,selectedRuleIds:Object(r.OrderedSet)(),isSubmitting:!1,isSubmitted:!1},this.handleSubmit=()=>{const{dispatch:e,accountId:t}=this.props,{selectedStatusIds:a,selectedDomains:s,comment:o,category:l,selectedRuleIds:i}=this.state;this.setState({isSubmitting:!0}),e(Object(b.b)({account_id:t,status_ids:a.toArray(),forward_to_domains:s.toArray(),comment:o,forward:s.size>0,category:l,rule_ids:i.toArray()},this.handleSuccess,this.handleFail))},this.handleSuccess=()=>{this.setState({isSubmitting:!1,isSubmitted:!0,step:"thanks"})},this.handleFail=()=>{this.setState({isSubmitting:!1})},this.handleStatusToggle=(e,t)=>{const{selectedStatusIds:a}=this.state;t?this.setState({selectedStatusIds:a.add(e)}):this.setState({selectedStatusIds:a.remove(e)})},this.handleDomainToggle=(e,t)=>{t?this.setState((t=>({selectedDomains:t.selectedDomains.add(e)}))):this.setState((t=>({selectedDomains:t.selectedDomains.remove(e)})))},this.handleRuleToggle=(e,t)=>{t?this.setState((t=>({selectedRuleIds:t.selectedRuleIds.add(e)}))):this.setState((t=>({selectedRuleIds:t.selectedRuleIds.remove(e)})))},this.handleChangeCategory=e=>{this.setState({category:e})},this.handleChangeComment=e=>{this.setState({comment:e})},this.handleNextStep=e=>{this.setState({step:e})}}componentDidMount(){const{dispatch:e,accountId:t}=this.props;e(Object(j.r)(t,{withReplies:!0})),e(Object(m.o)())}render(){const{accountId:e,account:t,intl:a,onClose:o}=this.props;if(!t)return null;const{step:l,selectedStatusIds:i,selectedRuleIds:d,selectedDomains:r,comment:n,category:u,isSubmitting:g,isSubmitted:p}=this.state,b=t.get("acct").split("@")[1],m=!!b;let j;switch(l){case"category":j=Object(s.a)(S,{onNextStep:this.handleNextStep,startedFrom:this.props.statusId?"status":"account",category:u,onChangeCategory:this.handleChangeCategory});break;case"rules":j=Object(s.a)(z,{onNextStep:this.handleNextStep,selectedRuleIds:d,onToggle:this.handleRuleToggle});break;case"statuses":j=Object(s.a)(V,{onNextStep:this.handleNextStep,accountId:e,selectedStatusIds:i,onToggle:this.handleStatusToggle});break;case"comment":j=Object(s.a)(F,{onSubmit:this.handleSubmit,isSubmitting:g,isRemote:m,comment:n,domain:b,onChangeComment:this.handleChangeComment,statusIds:i,selectedDomains:r,onToggleDomain:this.handleDomainToggle});break;case"thanks":j=Object(s.a)(Q,{submitted:p,account:t,onClose:o})}return Object(s.a)("div",{className:"modal-root__modal report-dialog-modal"},void 0,Object(s.a)("div",{className:"report-modal__target"},void 0,Object(s.a)(O.a,{className:"report-modal__close",title:a.formatMessage(X.close),icon:"times",iconComponent:h.a,onClick:o,size:20}),Object(s.a)(c.a,{id:"report.target",defaultMessage:"Report {target}",values:{target:Object(s.a)("strong",{},void 0,t.get("acct"))}})),Object(s.a)("div",{className:"report-dialog-modal__container"},void 0,j))}}Z.propTypes={accountId:l.a.string.isRequired,statusId:l.a.string,dispatch:l.a.func.isRequired,intl:l.a.object.isRequired,account:u.a.map.isRequired};t.default=Object(p.connect)((()=>{const e=Object(E.e)();return(t,a)=>{let{accountId:s}=a;return{account:e(t,s)}}}))(Object(d.c)(Z))}}]);
//# sourceMappingURL=report_modal-bc8b7eb1d3fb5c45981a.chunk.js.map