(window.webpackJsonp=window.webpackJsonp||[]).push([[583],{1392:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a(1),l=a(3),o=a.n(l),d=a(8),r=a(22),c=a(50),n=a(19),h=a(10),p=a(40),u=a(181),b=a(32),m=a(25),_=a(2),g=a(30),f=a(328),j=a(5);class O extends _.PureComponent{constructor(){super(...arguments),Object(i.a)(this,"handleCloseClick",(()=>{const{onClose:e}=this.props;e()}))}render(){const{filter:e,contextType:t}=this.props;let a=null;e.get("expires_at")&&e.get("expires_at")<new Date&&(a=Object(j.jsxs)(j.Fragment,{children:[Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.expired_title",defaultMessage:"Expired filter!"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.expired_explanation",defaultMessage:"This filter category has expired, you will need to change the expiration date for it to apply."}))]}));let i=null;t&&!e.get("context").includes(Object(f.a)(t))&&(i=Object(j.jsxs)(j.Fragment,{children:[Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.context_mismatch_title",defaultMessage:"Context mismatch!"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.context_mismatch_explanation",defaultMessage:"This filter category does not apply to the context in which you have accessed this post. If you want the post to be filtered in this context too, you will have to edit the filter."}))]}));const l=Object(s.a)("a",{href:`/filters/${e.get("id")}/edit`},void 0,Object(s.a)(r.a,{id:"filter_modal.added.settings_link",defaultMessage:"settings page"}));return Object(j.jsxs)(j.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.title",defaultMessage:"Filter added!"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.short_explanation",defaultMessage:"This post has been added to the following filter category: {title}.",values:{title:e.get("title")}})),a,i,Object(s.a)("h4",{className:"report-dialog-modal__subtitle"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.review_and_configure_title",defaultMessage:"Filter settings"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(r.a,{id:"filter_modal.added.review_and_configure",defaultMessage:"To review and further configure this filter category, go to the {settings_link}.",values:{settings_link:l}})),Object(s.a)("div",{className:"flex-spacer"}),Object(s.a)("div",{className:"report-dialog-modal__actions"},void 0,Object(s.a)(g.a,{onClick:this.handleCloseClick},void 0,Object(s.a)(r.a,{id:"report.close",defaultMessage:"Done"})))]})}}var w=Object(h.connect)(((e,t)=>{let{filterId:a}=t;return{filter:e.getIn(["filters",a])}}))(O),N=a(188),v=a(397),x=a.n(v),y=a(16),C=a(303);const k=Object(d.d)({search:{id:"filter_modal.select_filter.search",defaultMessage:"Search or create"},clear:{id:"emoji_button.clear",defaultMessage:"Clear"}});class S extends _.PureComponent{constructor(){super(...arguments),Object(i.a)(this,"state",{searchValue:""}),Object(i.a)(this,"renderItem",(e=>{let t=null;return(e[3]||e[4])&&(t=Object(s.a)("span",{className:"language-dropdown__dropdown__results__item__common-name"},void 0,"(",e[3]&&Object(s.a)(r.a,{id:"filter_modal.select_filter.expired",defaultMessage:"expired"}),e[3]&&e[4]&&", ",e[4]&&Object(s.a)(r.a,{id:"filter_modal.select_filter.context_mismatch",defaultMessage:"does not apply to this context"}),")")),Object(s.a)("div",{role:"button",tabIndex:0,"data-index":e[0],className:"language-dropdown__dropdown__results__item",onClick:this.handleItemClick,onKeyDown:this.handleKeyDown},e[0],Object(s.a)("span",{className:"language-dropdown__dropdown__results__item__native-name"},void 0,e[1])," ",t)})),Object(i.a)(this,"handleSearchChange",(e=>{let{target:t}=e;this.setState({searchValue:t.value})})),Object(i.a)(this,"setListRef",(e=>{this.listNode=e})),Object(i.a)(this,"handleKeyDown",(e=>{const t=Array.from(this.listNode.childNodes).findIndex((t=>t===e.currentTarget));let a=null;switch(e.key){case" ":case"Enter":e.currentTarget.click();break;case"ArrowDown":a=this.listNode.childNodes[t+1]||this.listNode.firstChild;break;case"ArrowUp":a=this.listNode.childNodes[t-1]||this.listNode.lastChild;break;case"Tab":a=e.shiftKey?this.listNode.childNodes[t-1]||this.listNode.lastChild:this.listNode.childNodes[t+1]||this.listNode.firstChild;break;case"Home":a=this.listNode.firstChild;break;case"End":a=this.listNode.lastChild}a&&(a.focus(),e.preventDefault(),e.stopPropagation())})),Object(i.a)(this,"handleSearchKeyDown",(e=>{let t=null;switch(e.key){case"Tab":case"ArrowDown":t=this.listNode.firstChild,t&&(t.focus(),e.preventDefault(),e.stopPropagation())}})),Object(i.a)(this,"handleClear",(()=>{this.setState({searchValue:""})})),Object(i.a)(this,"handleItemClick",(e=>{const t=e.currentTarget.getAttribute("data-index");e.preventDefault(),this.props.onSelectFilter(t)})),Object(i.a)(this,"handleNewFilterClick",(e=>{e.preventDefault(),this.props.onNewFilter(this.state.searchValue)}))}search(){const{filters:e}=this.props,{searchValue:t}=this.state;return""===t?e:x.a.go(t,e,{keys:["1","2"],limit:5,threshold:-1e4}).map((e=>e.obj))}renderCreateNew(e){return Object(s.a)("div",{role:"button",tabIndex:0,className:"language-dropdown__dropdown__results__item",onClick:this.handleNewFilterClick,onKeyDown:this.handleKeyDown},"add-new-filter",Object(s.a)(y.a,{id:"plus",icon:N.a})," ",Object(s.a)(r.a,{id:"filter_modal.select_filter.prompt_new",defaultMessage:"New category: {name}",values:{name:e}}))}render(){const{intl:e}=this.props,{searchValue:t}=this.state,a=""!==t,i=this.search();return Object(j.jsxs)(j.Fragment,{children:[Object(s.a)("h3",{className:"report-dialog-modal__title"},void 0,Object(s.a)(r.a,{id:"filter_modal.select_filter.title",defaultMessage:"Filter this post"})),Object(s.a)("p",{className:"report-dialog-modal__lead"},void 0,Object(s.a)(r.a,{id:"filter_modal.select_filter.subtitle",defaultMessage:"Use an existing category or create a new one"})),Object(s.a)("div",{className:"emoji-mart-search"},void 0,Object(s.a)("input",{type:"search",value:t,onChange:this.handleSearchChange,onKeyDown:this.handleSearchKeyDown,placeholder:e.formatMessage(k.search),autoFocus:!0}),Object(s.a)("button",{type:"button",className:"emoji-mart-search-icon",disabled:!a,"aria-label":e.formatMessage(k.clear),onClick:this.handleClear},void 0,a?C.a:C.b)),Object(j.jsxs)("div",{className:"language-dropdown__dropdown__results emoji-mart-scroll",role:"listbox",ref:this.setListRef,children:[i.map(this.renderItem),a&&this.renderCreateNew(t)]})]})}}var F=Object(h.connect)(((e,t)=>{let{contextType:a}=t;return{filters:Array.from(e.get("filters").values()).map((e=>{var t;return[e.get("id"),e.get("title"),null===(t=e.get("keywords"))||void 0===t?void 0:t.map((e=>e.get("keyword"))).join("\n"),e.get("expires_at")&&e.get("expires_at")<new Date,a&&!e.get("context").includes(Object(f.a)(a))]}))}}))(Object(c.c)(S));const M=Object(d.d)({close:{id:"lightbox.close",defaultMessage:"Close"}});class I extends n.a{constructor(){super(...arguments),Object(i.a)(this,"state",{step:"select",filterId:null,isSubmitting:!1,isSubmitted:!1}),Object(i.a)(this,"handleNewFilterSuccess",(e=>{this.handleSelectFilter(e.id)})),Object(i.a)(this,"handleSuccess",(()=>{const{dispatch:e,statusId:t}=this.props;e(Object(b.n)(t,!0)),this.setState({isSubmitting:!1,isSubmitted:!0,step:"submitted"})})),Object(i.a)(this,"handleFail",(()=>{this.setState({isSubmitting:!1})})),Object(i.a)(this,"handleNextStep",(e=>{this.setState({step:e})})),Object(i.a)(this,"handleSelectFilter",(e=>{const{dispatch:t,statusId:a}=this.props;this.setState({isSubmitting:!0,filterId:e}),t(Object(u.d)({filter_id:e,status_id:a},this.handleSuccess,this.handleFail))})),Object(i.a)(this,"handleNewFilter",(e=>{const{dispatch:t}=this.props;this.setState({isSubmitting:!0}),t(Object(u.c)({title:e,context:["home","notifications","public","thread","account"],action:"warn"},this.handleNewFilterSuccess,this.handleFail))}))}componentDidMount(){const{dispatch:e}=this.props;e(Object(u.e)())}render(){const{intl:e,statusId:t,contextType:a,onClose:i}=this.props,{step:l,filterId:o}=this.state;let d;switch(l){case"select":d=Object(s.a)(F,{contextType:a,onSelectFilter:this.handleSelectFilter,onNewFilter:this.handleNewFilter});break;case"create":d=null;break;case"submitted":d=Object(s.a)(w,{contextType:a,filterId:o,statusId:t,onClose:i})}return Object(s.a)("div",{className:"modal-root__modal report-dialog-modal"},void 0,Object(s.a)("div",{className:"report-modal__target"},void 0,Object(s.a)(m.a,{className:"report-modal__close",title:e.formatMessage(M.close),icon:"times",iconComponent:p.a,onClick:i,size:20}),Object(s.a)(r.a,{id:"filter_modal.title.status",defaultMessage:"Filter a post"})),Object(s.a)("div",{className:"report-dialog-modal__container"},void 0,d))}}Object(i.a)(I,"propTypes",{statusId:o.a.string.isRequired,contextType:o.a.string,dispatch:o.a.func.isRequired,intl:o.a.object.isRequired});t.default=Object(h.connect)()(Object(c.c)(I))}}]);
//# sourceMappingURL=filter_modal-d9c925f389a3eebb2160.chunk.js.map