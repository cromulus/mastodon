(window.webpackJsonp=window.webpackJsonp||[]).push([[466],{1380:function(e,t,n){"use strict";n.r(t);var a,s=n(0),i=n(1),o=(n(31),n(3)),c=n.n(o),r=n(2),l=n(8),d=n(22),u=n(50),m=n(11),h=n.n(m),p=n(97),b=n(4),g=n(10),j=n(41);function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},v.apply(this,arguments)}function O(e){let{title:t,titleId:n,...s}=e;return r.createElement("svg",v({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 -960 960 960","aria-labelledby":n},s),t?r.createElement("title",{id:n},t):null,a||(a=r.createElement("path",{d:"M736.218-443.782v-72.436h169.783v72.436H736.218Zm63.566 296.783L662.957-248.87l43.913-58.174 136.262 101.305-43.348 58.74ZM709.87-653.956l-43.913-58.174 133.827-100.871 43.348 58.175-133.262 100.87ZM183.999-185.869v-160h-57q-30.967-2.261-51.984-25.291Q54-394.19 54-425.087v-109.826q0-32.91 23.436-56.347 23.437-23.436 56.347-23.436h170.391l218.653-130.74v530.872L304.173-345.869h-38.13v160h-82.044Zm259.044-168.61v-251.042L324.13-534.913H133.782v109.826H324.13l118.913 70.608Zm119.783 22.61v-296.827q33.218 25.695 53.109 64.435 19.892 38.739 19.892 84.261t-19.779 84.207q-19.778 38.684-53.222 63.924ZM288.695-480Z"})))}n.p;var _=n(317),f=n(59),M=n(219),y=n(1246),w=n(33),R=n(17),x=n.n(R),k=n(19),C=n(188),I=n(218),N=n(151),q=n(516),A=n.n(q),L=n(76),P=n.n(L),S=n(332),E=n.n(S),D=n(321),T=n(330),z=n(16),F=n(25),H=n(484),Y=n(134),$=n(6),K=n(89),U=n(37),Z=n(5);const B=Object(l.d)({close:{id:"lightbox.close",defaultMessage:"Close"},previous:{id:"lightbox.previous",defaultMessage:"Previous"},next:{id:"lightbox.next",defaultMessage:"Next"}});class J extends k.a{constructor(){super(...arguments),Object(i.a)(this,"setRef",(e=>{this.node=e})),Object(i.a)(this,"onMentionClick",((e,t)=>{!this.props.history||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.props.history.push(`/@${e.get("acct")}`))})),Object(i.a)(this,"onHashtagClick",((e,t)=>{e=e.replace(/^#/,""),!this.props.history||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.props.history.push(`/tags/${e}`))})),Object(i.a)(this,"onStatusClick",((e,t)=>{!this.props.history||0!==t.button||t.ctrlKey||t.metaKey||(t.preventDefault(),this.props.history.push(`/@${e.getIn(["account","acct"])}/${e.get("id")}`))})),Object(i.a)(this,"handleMouseEnter",(e=>{let{currentTarget:t}=e;if($.a)return;const n=t.querySelectorAll(".custom-emoji");for(var a=0;a<n.length;a++){let e=n[a];e.src=e.getAttribute("data-original")}})),Object(i.a)(this,"handleMouseLeave",(e=>{let{currentTarget:t}=e;if($.a)return;const n=t.querySelectorAll(".custom-emoji");for(var a=0;a<n.length;a++){let e=n[a];e.src=e.getAttribute("data-static")}}))}componentDidMount(){this._updateLinks()}componentDidUpdate(){this._updateLinks()}_updateLinks(){const e=this.node;if(!e)return;const t=e.querySelectorAll("a");for(var n=0;n<t.length;++n){let e=t[n];if(e.classList.contains("status-link"))continue;e.classList.add("status-link");let a=this.props.announcement.get("mentions").find((t=>e.href===t.get("url")));if(a)e.addEventListener("click",this.onMentionClick.bind(this,a),!1),e.setAttribute("title",a.get("acct"));else if("#"===e.textContent[0]||e.previousSibling&&e.previousSibling.textContent&&"#"===e.previousSibling.textContent[e.previousSibling.textContent.length-1])e.addEventListener("click",this.onHashtagClick.bind(this,e.text),!1);else{let t=this.props.announcement.get("statuses").find((t=>e.href===t.get("url")));t&&e.addEventListener("click",this.onStatusClick.bind(this,t),!1),e.setAttribute("title",e.href),e.classList.add("unhandled-link")}e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")}}render(){const{announcement:e}=this.props;return Object(Z.jsx)("div",{className:"announcements__item__content translate",ref:this.setRef,dangerouslySetInnerHTML:{__html:e.get("contentHtml")},onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave})}}Object(i.a)(J,"propTypes",{announcement:x.a.map.isRequired,...U.b});const Q=Object(w.i)(J);class W extends r.PureComponent{render(){const{emoji:e,emojiMap:t,hovered:n}=this.props;if(Y.a[e]){const{filename:t,shortCode:n}=Y.a[this.props.emoji],a=n?`:${n}:`:"";return Object(s.a)("img",{draggable:"false",className:"emojione",alt:e,title:a,src:`${K.a}/emoji/${t}.svg`})}if(t.get(e)){const a=$.a||n?t.getIn([e,"url"]):t.getIn([e,"static_url"]),i=`:${e}:`;return Object(s.a)("img",{draggable:"false",className:"emojione custom-emoji",alt:i,title:i,src:a})}return null}}class G extends k.a{constructor(){super(...arguments),Object(i.a)(this,"state",{hovered:!1}),Object(i.a)(this,"handleClick",(()=>{const{reaction:e,announcementId:t,addReaction:n,removeReaction:a}=this.props;e.get("me")?a(t,e.get("name")):n(t,e.get("name"))})),Object(i.a)(this,"handleMouseEnter",(()=>this.setState({hovered:!0}))),Object(i.a)(this,"handleMouseLeave",(()=>this.setState({hovered:!1})))}render(){const{reaction:e}=this.props;let t=e.get("name");return Y.a[t]&&(t=Y.a[t].shortCode),Object(s.a)("button",{className:h()("reactions-bar__item",{active:e.get("me")}),onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,title:`:${t}:`,style:this.props.style},void 0,Object(s.a)("span",{className:"reactions-bar__item__emoji"},void 0,Object(s.a)(W,{hovered:this.state.hovered,emoji:e.get("name"),emojiMap:this.props.emojiMap})),Object(s.a)("span",{className:"reactions-bar__item__count"},void 0,Object(s.a)(T.a,{value:e.get("count")})))}}Object(i.a)(G,"propTypes",{announcementId:c.a.string.isRequired,reaction:x.a.map.isRequired,addReaction:c.a.func.isRequired,removeReaction:c.a.func.isRequired,emojiMap:x.a.map.isRequired,style:c.a.object});class V extends k.a{constructor(){super(...arguments),Object(i.a)(this,"handleEmojiPick",(e=>{const{addReaction:t,announcementId:n}=this.props;t(n,e.native.replace(/:/g,""))}))}willEnter(){return{scale:$.s?1:0}}willLeave(){return{scale:$.s?0:P()(0,{stiffness:170,damping:26})}}render(){const{reactions:e}=this.props,t=e.filter((e=>e.get("count")>0)),n=t.map((e=>({key:e.get("name"),data:e,style:{scale:$.s?1:P()(1,{stiffness:150,damping:13})}}))).toArray();return Object(s.a)(A.a,{styles:n,willEnter:this.willEnter,willLeave:this.willLeave},void 0,(e=>Object(s.a)("div",{className:h()("reactions-bar",{"reactions-bar--empty":t.isEmpty()})},void 0,e.map((e=>{let{key:t,data:n,style:a}=e;return Object(s.a)(G,{reaction:n,style:{transform:`scale(${a.scale})`,position:a.scale<.5?"absolute":"static"},announcementId:this.props.announcementId,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap},t)})),t.size<8&&Object(s.a)(H.a,{onPickEmoji:this.handleEmojiPick,button:Object(s.a)(z.a,{id:"plus",icon:C.a})}))))}}Object(i.a)(V,"propTypes",{announcementId:c.a.string.isRequired,reactions:x.a.list.isRequired,addReaction:c.a.func.isRequired,removeReaction:c.a.func.isRequired,emojiMap:x.a.map.isRequired});class X extends k.a{constructor(){super(...arguments),Object(i.a)(this,"state",{unread:!this.props.announcement.get("read")})}componentDidUpdate(){const{selected:e,announcement:t}=this.props;e||this.state.unread===!t.get("read")||this.setState({unread:!t.get("read")})}render(){const{announcement:e}=this.props,{unread:t}=this.state,n=e.get("starts_at")&&new Date(e.get("starts_at")),a=e.get("ends_at")&&new Date(e.get("ends_at")),i=new Date,o=n&&a,c=o&&n.getFullYear()===a.getFullYear()&&a.getFullYear()===i.getFullYear(),r=o&&n.getDate()===a.getDate()&&n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear(),u=e.get("all_day");return Object(s.a)("div",{className:"announcements__item"},void 0,Object(s.a)("strong",{className:"announcements__item__range"},void 0,Object(s.a)(d.a,{id:"announcement.announcement",defaultMessage:"Announcement"}),o&&Object(s.a)("span",{},void 0," Â· ",Object(s.a)(l.a,{value:n,hour12:!1,year:c||n.getFullYear()===i.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:u?void 0:"2-digit",minute:u?void 0:"2-digit"})," - ",Object(s.a)(l.a,{value:a,hour12:!1,year:c||a.getFullYear()===i.getFullYear()?void 0:"numeric",month:r?void 0:"short",day:r?void 0:"2-digit",hour:u?void 0:"2-digit",minute:u?void 0:"2-digit"}))),Object(s.a)(Q,{announcement:e}),Object(s.a)(V,{reactions:e.get("reactions"),announcementId:e.get("id"),addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,emojiMap:this.props.emojiMap}),t&&Object(s.a)("span",{className:"announcements__item__unread"}))}}Object(i.a)(X,"propTypes",{announcement:x.a.map.isRequired,emojiMap:x.a.map.isRequired,addReaction:c.a.func.isRequired,removeReaction:c.a.func.isRequired,intl:c.a.object.isRequired,selected:c.a.bool});class ee extends k.a{constructor(){super(...arguments),Object(i.a)(this,"state",{index:0}),Object(i.a)(this,"handleChangeIndex",(e=>{this.setState({index:e%this.props.announcements.size})})),Object(i.a)(this,"handleNextClick",(()=>{this.setState({index:(this.state.index+1)%this.props.announcements.size})})),Object(i.a)(this,"handlePrevClick",(()=>{this.setState({index:(this.props.announcements.size+this.state.index-1)%this.props.announcements.size})}))}static getDerivedStateFromProps(e,t){return e.announcements.size>0&&t.index>=e.announcements.size?{index:e.announcements.size-1}:null}componentDidMount(){this._markAnnouncementAsRead()}componentDidUpdate(){this._markAnnouncementAsRead()}_markAnnouncementAsRead(){const{dismissAnnouncement:e,announcements:t}=this.props,{index:n}=this.state,a=t.get(t.size-1-n);a.get("read")||e(a.get("id"))}render(){const{announcements:e,intl:t}=this.props,{index:n}=this.state;return e.isEmpty()?null:Object(s.a)("div",{className:"announcements"},void 0,Object(s.a)("img",{className:"announcements__mastodon",alt:"",draggable:"false",src:$.n||D.default}),Object(s.a)("div",{className:"announcements__container"},void 0,Object(s.a)(E.a,{animateHeight:!0,animateTransitions:!$.s,index:n,onChangeIndex:this.handleChangeIndex},void 0,e.map(((e,a)=>Object(s.a)(X,{announcement:e,emojiMap:this.props.emojiMap,addReaction:this.props.addReaction,removeReaction:this.props.removeReaction,intl:t,selected:n===a,disabled:$.f},e.get("id")))).reverse()),e.size>1&&Object(s.a)("div",{className:"announcements__pagination"},void 0,Object(s.a)(F.a,{disabled:1===e.size,title:t.formatMessage(B.previous),icon:"chevron-left",iconComponent:I.a,onClick:this.handlePrevClick,size:13}),Object(s.a)("span",{},void 0,n+1," / ",e.size),Object(s.a)(F.a,{disabled:1===e.size,title:t.formatMessage(B.next),icon:"chevron-right",iconComponent:N.a,onClick:this.handleNextClick,size:13}))))}}Object(i.a)(ee,"propTypes",{announcements:x.a.list,emojiMap:x.a.map.isRequired,dismissAnnouncement:c.a.func.isRequired,addReaction:c.a.func.isRequired,removeReaction:c.a.func.isRequired,intl:c.a.object.isRequired});var te=Object(u.c)(ee);const ne=Object(j.a)([e=>e.get("custom_emojis")],(e=>e.reduce(((e,t)=>e.set(t.get("shortcode"),t)),Object(b.Map)())));var ae=Object(g.connect)((e=>({announcements:e.getIn(["announcements","items"]),emojiMap:ne(e)})),(e=>({dismissAnnouncement:t=>e(Object(f.o)(t)),addReaction:(t,n)=>e(Object(f.m)(t,n)),removeReaction:(t,n)=>e(Object(f.q)(t,n))})))(te),se=n(169),ie=n(23),oe=n(185),ce=n(183),re=n(1238),le=n(63),de=n(57),ue=n(1237);const me=()=>{const e=Object(le.c)((e=>e.settings.get("home"))),t=Object(le.b)(),n=Object(r.useCallback)(((e,n)=>{t(Object(de.c)(["home",...e],n))}),[t]);return Object(s.a)("div",{},void 0,Object(s.a)("span",{className:"column-settings__section"},void 0,Object(s.a)(d.a,{id:"home.column_settings.basic",defaultMessage:"Basic"})),Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)(ue.a,{prefix:"home_timeline",settings:e,settingPath:["shows","reblog"],onChange:n,label:Object(s.a)(d.a,{id:"home.column_settings.show_reblogs",defaultMessage:"Show boosts"})})),Object(s.a)("div",{className:"column-settings__row"},void 0,Object(s.a)(ue.a,{prefix:"home_timeline",settings:e,settingPath:["shows","reply"],onChange:n,label:Object(s.a)(d.a,{id:"home.column_settings.show_replies",defaultMessage:"Show replies"})})))},he=()=>Object(s.a)("div",{className:"warning-banner"},void 0,Object(s.a)("div",{className:"warning-banner__message"},void 0,Object(s.a)("h1",{},void 0,Object(s.a)(d.a,{id:"home.pending_critical_update.title",defaultMessage:"Critical security update available!"})),Object(s.a)("p",{},void 0,Object(s.a)(d.a,{id:"home.pending_critical_update.body",defaultMessage:"Please update your Mastodon server as soon as possible!"})," ",Object(s.a)("a",{href:"/admin/software_updates"},void 0,Object(s.a)(d.a,{id:"home.pending_critical_update.link",defaultMessage:"See updates"})))));var pe=n(21),be=n(327),ge=n(1235);const je=()=>Object(s.a)(ge.a,{id:"home.explore_prompt"},void 0,Object(s.a)("img",{src:be.default,alt:"",className:"dismissable-banner__background-image"}),Object(s.a)("h1",{},void 0,Object(s.a)(d.a,{id:"home.explore_prompt.title",defaultMessage:"This is your home base within Mastodon."})),Object(s.a)("p",{},void 0,Object(s.a)(d.a,{id:"home.explore_prompt.body",defaultMessage:"Your home feed will have a mix of posts from the hashtags you've chosen to follow, the people you've chosen to follow, and the posts they boost. If that feels too quiet, you may want to:"})),Object(s.a)("div",{className:"dismissable-banner__message__wrapper"},void 0,Object(s.a)("div",{className:"dismissable-banner__message__actions"},void 0,Object(s.a)(pe.a,{to:"/explore",className:"button"},void 0,Object(s.a)(d.a,{id:"home.actions.go_to_explore",defaultMessage:"See what's trending"})),Object(s.a)(pe.a,{to:"/explore/suggestions",className:"button button-tertiary"},void 0,Object(s.a)(d.a,{id:"home.actions.go_to_suggestions",defaultMessage:"Find people to follow"}))))),ve=Object(l.d)({title:{id:"column.home",defaultMessage:"Home"},show_announcements:{id:"home.show_announcements",defaultMessage:"Show announcements"},hide_announcements:{id:"home.hide_announcements",defaultMessage:"Hide announcements"}}),Oe=Object(j.a)([e=>e.getIn(["timelines","home","items"],Object(b.List)()),e=>e.getIn(["timelines","home","pendingItems"],Object(b.List)()),e=>e.get("statuses")],((e,t,n)=>{const a=t.concat(e).filter((e=>null!==e)).map((e=>n.get(e))).filter((e=>(null==e?void 0:e.get("account"))!==$.o)).take(20);if(a.isEmpty())return{gap:0,newest:new Date(0)};const s=a.map((e=>e.get("created_at",0))),i=new Date(s.min()),o=new Date(s.max());return{gap:(o-i)/(1e3*(a.size+1)),newest:o}})),_e=Object(j.a)([e=>e.getIn(["timelines","home","isLoading"]),e=>e.getIn(["timelines","home","isPartial"]),Oe],((e,t,n)=>!e&&!t&&(n.gap>1800||Date.now()-n.newest>36e5)));class fe extends r.PureComponent{constructor(){super(...arguments),Object(i.a)(this,"handlePin",(()=>{const{columnId:e,dispatch:t}=this.props;t(e?Object(se.h)(e):Object(se.e)("HOME",{}))})),Object(i.a)(this,"handleMove",(e=>{const{columnId:t,dispatch:n}=this.props;n(Object(se.g)(t,e))})),Object(i.a)(this,"handleHeaderClick",(()=>{this.column.scrollTop()})),Object(i.a)(this,"setRef",(e=>{this.column=e})),Object(i.a)(this,"handleLoadMore",(e=>{this.props.dispatch(Object(ie.u)({maxId:e}))})),Object(i.a)(this,"handleToggleAnnouncementsClick",(e=>{e.stopPropagation(),this.props.dispatch(Object(f.r)())}))}componentDidMount(){setTimeout((()=>this.props.dispatch(Object(f.p)())),700),this._checkIfReloadNeeded(!1,this.props.isPartial)}componentDidUpdate(e){this._checkIfReloadNeeded(e.isPartial,this.props.isPartial)}componentWillUnmount(){this._stopPolling()}_checkIfReloadNeeded(e,t){const{dispatch:n}=this.props;e!==t&&(!e&&t?this.polling=setInterval((()=>{n(Object(ie.u)())}),3e3):e&&!t&&this._stopPolling())}_stopPolling(){this.polling&&(clearInterval(this.polling),this.polling=null)}render(){const{intl:e,hasUnread:t,columnId:n,multiColumn:a,tooSlow:i,hasAnnouncements:o,unreadAnnouncements:c,showAnnouncements:r}=this.props,l=!!n,{signedIn:u}=this.context.identity,m=[];let b;return o&&(b=Object(s.a)("button",{type:"button",className:h()("column-header__button",{active:r}),title:e.formatMessage(r?ve.hide_announcements:ve.show_announcements),"aria-label":e.formatMessage(r?ve.hide_announcements:ve.show_announcements),onClick:this.handleToggleAnnouncementsClick},void 0,Object(s.a)(M.a,{id:"bullhorn",icon:O,count:c}))),$.c&&m.push(Object(s.a)(he,{},"critical-update-banner")),i&&m.push(Object(s.a)(je,{},"explore-prompt")),Object(Z.jsxs)(oe.a,{bindToDocument:!a,ref:this.setRef,label:e.formatMessage(ve.title),children:[Object(s.a)(ce.a,{icon:"home",iconComponent:_.a,active:t,title:e.formatMessage(ve.title),onPin:this.handlePin,onMove:this.handleMove,onClick:this.handleHeaderClick,pinned:l,multiColumn:a,extraButton:b,appendContent:o&&r&&Object(s.a)(ae,{})},void 0,Object(s.a)(me,{})),u?Object(s.a)(re.a,{prepend:m,alwaysPrepend:!0,trackScroll:!l,scrollKey:`home_timeline-${n}`,onLoadMore:this.handleLoadMore,timelineId:"home",emptyMessage:Object(s.a)(d.a,{id:"empty_column.home",defaultMessage:"Your home timeline is empty! Follow more people to fill it up."}),bindToDocument:!a}):Object(s.a)(y.a,{}),Object(s.a)(p.a,{},void 0,Object(s.a)("title",{},void 0,e.formatMessage(ve.title)),Object(s.a)("meta",{name:"robots",content:"noindex"}))]})}}Object(i.a)(fe,"contextTypes",{identity:c.a.object});t.default=Object(g.connect)((e=>({hasUnread:e.getIn(["timelines","home","unread"])>0,isPartial:e.getIn(["timelines","home","isPartial"]),hasAnnouncements:!e.getIn(["announcements","items"]).isEmpty(),unreadAnnouncements:e.getIn(["announcements","items"]).count((e=>!e.get("read"))),showAnnouncements:e.getIn(["announcements","show"]),tooSlow:_e(e)})))(Object(u.c)(fe))}}]);
//# sourceMappingURL=home_timeline-cea967bedc3587fae6bb.chunk.js.map