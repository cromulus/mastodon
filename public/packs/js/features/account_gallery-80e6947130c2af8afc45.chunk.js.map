{"version":3,"sources":["webpack:///./node_modules/@material-symbols/svg-600/outlined/music_note.svg","webpack:///./node_modules/@material-symbols/svg-600/outlined/play_arrow.svg","webpack:///./app/javascript/mastodon/features/account_gallery/components/media_item.jsx","webpack:///./app/javascript/mastodon/features/account_gallery/index.jsx"],"names":["_path","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","SvgMusicNote","_ref","title","titleId","props","xmlns","width","height","viewBox","id","d","SvgPlayArrow","MediaItem","ImmutablePureComponent","constructor","_defineProperty","visible","displayMedia","attachment","getIn","loaded","setState","e","hoverToPlay","play","pause","currentTime","button","ctrlKey","metaKey","preventDefault","state","onOpenMedia","autoPlayGif","indexOf","get","render","displayWidth","Math","floor","status","thumbnail","label","icon","content","includes","_jsx","src","alt","lang","onLoad","handleImageLoad","Icon","AudiotrackIcon","PlayArrowIcon","x","y","style","objectPosition","className","role","onMouseEnter","handleMouseEnter","onMouseLeave","handleMouseLeave","autoPlay","playsInline","loop","muted","VisibilityOffIcon","href","onClick","handleClick","rel","Blurhash","hash","classNames","dummy","useBlurhash","ImmutablePropTypes","map","isRequired","PropTypes","number","func","LoadMoreMedia","onLoadMore","maxId","LoadMore","disabled","handleLoadMore","string","AccountGallery","hasMore","attachments","size","last","undefined","scrollTop","scrollHeight","clientHeight","isLoading","handleScrollToBottom","dispatch","expandAccountMediaTimeline","accountId","statusId","openModal","modalType","modalProps","media","options","index","findIndex","c","offsetWidth","_load","isAccount","fetchAccount","componentDidMount","params","acct","lookupAccount","componentDidUpdate","prevProps","multiColumn","blockedBy","suspended","BundleColumnError","errorType","Column","LoadingIndicator","emptyMessage","loadOlder","handleLoadOlder","FormattedMessage","defaultMessage","ColumnBackButton","ScrollContainer","scrollKey","onScroll","handleScroll","HeaderContainer","_jsxs","ref","handleRef","children","handleOpenMedia","shape","list","bool","connect","mapStateToProps","normalizeForLookup","getAccountGallery"],"mappings":"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","file":"js/features/account_gallery-80e6947130c2af8afc45.chunk.js","sourcesContent":["var _path;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgMusicNote(_ref) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 48,\n    height: 48,\n    viewBox: \"0 -960 960 960\",\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M388.478-104.173q-66.964 0-113.286-46.323-46.323-46.322-46.323-113.286t46.323-113.287q46.322-46.322 113.286-46.322 25.064 0 45.075 6.586 20.012 6.587 35.316 18.326v-457.913h262.827v154.783H548.087v437.827q0 66.964-46.322 113.286-46.323 46.323-113.287 46.323Z\"\n  })));\n}\nexport default __webpack_public_path__ + \"media/outlined/music_note-983c1336.svg\";\nexport { SvgMusicNote as ReactComponent };","var _path;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nfunction SvgPlayArrow(_ref) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 48,\n    height: 48,\n    viewBox: \"0 -960 960 960\",\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M305.869-176.999v-612.002L786.567-483 305.869-176.999ZM385.087-483Zm0 161.391L639.391-483 385.087-644.391v322.782Z\"\n  })));\n}\nexport default __webpack_public_path__ + \"media/outlined/play_arrow-6b623c01.svg\";\nexport { SvgPlayArrow as ReactComponent };","import PropTypes from 'prop-types';\n\nimport classNames from 'classnames';\n\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport ImmutablePureComponent from 'react-immutable-pure-component';\n\nimport { ReactComponent as AudiotrackIcon } from '@material-symbols/svg-600/outlined/music_note.svg';\nimport { ReactComponent as PlayArrowIcon } from '@material-symbols/svg-600/outlined/play_arrow.svg';\nimport { ReactComponent as VisibilityOffIcon } from '@material-symbols/svg-600/outlined/visibility_off.svg';\n\nimport { Blurhash } from 'mastodon/components/blurhash';\nimport { Icon }  from 'mastodon/components/icon';\nimport { autoPlayGif, displayMedia, useBlurhash } from 'mastodon/initial_state';\n\nexport default class MediaItem extends ImmutablePureComponent {\n\n  static propTypes = {\n    attachment: ImmutablePropTypes.map.isRequired,\n    displayWidth: PropTypes.number.isRequired,\n    onOpenMedia: PropTypes.func.isRequired,\n  };\n\n  state = {\n    visible: displayMedia !== 'hide_all' && !this.props.attachment.getIn(['status', 'sensitive']) || displayMedia === 'show_all',\n    loaded: false,\n  };\n\n  handleImageLoad = () => {\n    this.setState({ loaded: true });\n  };\n\n  handleMouseEnter = e => {\n    if (this.hoverToPlay()) {\n      e.target.play();\n    }\n  };\n\n  handleMouseLeave = e => {\n    if (this.hoverToPlay()) {\n      e.target.pause();\n      e.target.currentTime = 0;\n    }\n  };\n\n  hoverToPlay () {\n    return !autoPlayGif && ['gifv', 'video'].indexOf(this.props.attachment.get('type')) !== -1;\n  }\n\n  handleClick = e => {\n    if (e.button === 0 && !(e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n\n      if (this.state.visible) {\n        this.props.onOpenMedia(this.props.attachment);\n      } else {\n        this.setState({ visible: true });\n      }\n    }\n  };\n\n  render () {\n    const { attachment, displayWidth } = this.props;\n    const { visible, loaded } = this.state;\n\n    const width  = `${Math.floor((displayWidth - 4) / 3) - 4}px`;\n    const height = width;\n    const status = attachment.get('status');\n    const title  = status.get('spoiler_text') || attachment.get('description');\n\n    let thumbnail, label, icon, content;\n\n    if (!visible) {\n      icon = (\n        <span className='account-gallery__item__icons'>\n          <Icon id='eye-slash' icon={VisibilityOffIcon} />\n        </span>\n      );\n    } else {\n      if (['audio', 'video'].includes(attachment.get('type'))) {\n        content = (\n          <img\n            src={attachment.get('preview_url') || status.getIn(['account', 'avatar_static'])}\n            alt={attachment.get('description')}\n            lang={status.get('language')}\n            onLoad={this.handleImageLoad}\n          />\n        );\n\n        if (attachment.get('type') === 'audio') {\n          label = <Icon id='music' icon={AudiotrackIcon} />;\n        } else {\n          label = <Icon id='play' icon={PlayArrowIcon} />;\n        }\n      } else if (attachment.get('type') === 'image') {\n        const focusX = attachment.getIn(['meta', 'focus', 'x']) || 0;\n        const focusY = attachment.getIn(['meta', 'focus', 'y']) || 0;\n        const x      = ((focusX /  2) + .5) * 100;\n        const y      = ((focusY / -2) + .5) * 100;\n\n        content = (\n          <img\n            src={attachment.get('preview_url')}\n            alt={attachment.get('description')}\n            lang={status.get('language')}\n            style={{ objectPosition: `${x}% ${y}%` }}\n            onLoad={this.handleImageLoad}\n          />\n        );\n      } else if (attachment.get('type') === 'gifv') {\n        content = (\n          <video\n            className='media-gallery__item-gifv-thumbnail'\n            aria-label={attachment.get('description')}\n            title={attachment.get('description')}\n            lang={status.get('language')}\n            role='application'\n            src={attachment.get('url')}\n            onMouseEnter={this.handleMouseEnter}\n            onMouseLeave={this.handleMouseLeave}\n            autoPlay={autoPlayGif}\n            playsInline\n            loop\n            muted\n          />\n        );\n\n        label = 'GIF';\n      }\n\n      thumbnail = (\n        <div className='media-gallery__gifv'>\n          {content}\n\n          {label && (\n            <div className='media-gallery__item__badges'>\n              <span className='media-gallery__gifv__label'>{label}</span>\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <div className='account-gallery__item' style={{ width, height }}>\n        <a className='media-gallery__item-thumbnail' href={`/@${status.getIn(['account', 'acct'])}/${status.get('id')}`} onClick={this.handleClick} title={title} target='_blank' rel='noopener noreferrer'>\n          <Blurhash\n            hash={attachment.get('blurhash')}\n            className={classNames('media-gallery__preview', { 'media-gallery__preview--hidden': visible && loaded })}\n            dummy={!useBlurhash}\n          />\n\n          {visible ? thumbnail : icon}\n        </a>\n      </div>\n    );\n  }\n\n}\n","import PropTypes from 'prop-types';\n\nimport { FormattedMessage } from 'react-intl';\n\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport ImmutablePureComponent from 'react-immutable-pure-component';\nimport { connect } from 'react-redux';\n\nimport { lookupAccount, fetchAccount } from 'mastodon/actions/accounts';\nimport { openModal } from 'mastodon/actions/modal';\nimport { ColumnBackButton } from 'mastodon/components/column_back_button';\nimport { LoadMore } from 'mastodon/components/load_more';\nimport { LoadingIndicator } from 'mastodon/components/loading_indicator';\nimport ScrollContainer from 'mastodon/containers/scroll_container';\nimport BundleColumnError from 'mastodon/features/ui/components/bundle_column_error';\nimport { normalizeForLookup } from 'mastodon/reducers/accounts_map';\nimport { getAccountGallery } from 'mastodon/selectors';\n\nimport { expandAccountMediaTimeline } from '../../actions/timelines';\nimport HeaderContainer from '../account_timeline/containers/header_container';\nimport Column from '../ui/components/column';\n\nimport MediaItem from './components/media_item';\n\nconst mapStateToProps = (state, { params: { acct, id } }) => {\n  const accountId = id || state.getIn(['accounts_map', normalizeForLookup(acct)]);\n\n  if (!accountId) {\n    return {\n      isLoading: true,\n    };\n  }\n\n  return {\n    accountId,\n    isAccount: !!state.getIn(['accounts', accountId]),\n    attachments: getAccountGallery(state, accountId),\n    isLoading: state.getIn(['timelines', `account:${accountId}:media`, 'isLoading']),\n    hasMore: state.getIn(['timelines', `account:${accountId}:media`, 'hasMore']),\n    suspended: state.getIn(['accounts', accountId, 'suspended'], false),\n    blockedBy: state.getIn(['relationships', accountId, 'blocked_by'], false),\n  };\n};\n\nclass LoadMoreMedia extends ImmutablePureComponent {\n\n  static propTypes = {\n    maxId: PropTypes.string,\n    onLoadMore: PropTypes.func.isRequired,\n  };\n\n  handleLoadMore = () => {\n    this.props.onLoadMore(this.props.maxId);\n  };\n\n  render () {\n    return (\n      <LoadMore\n        disabled={this.props.disabled}\n        onClick={this.handleLoadMore}\n      />\n    );\n  }\n\n}\n\nclass AccountGallery extends ImmutablePureComponent {\n\n  static propTypes = {\n    params: PropTypes.shape({\n      acct: PropTypes.string,\n      id: PropTypes.string,\n    }).isRequired,\n    accountId: PropTypes.string,\n    dispatch: PropTypes.func.isRequired,\n    attachments: ImmutablePropTypes.list.isRequired,\n    isLoading: PropTypes.bool,\n    hasMore: PropTypes.bool,\n    isAccount: PropTypes.bool,\n    blockedBy: PropTypes.bool,\n    suspended: PropTypes.bool,\n    multiColumn: PropTypes.bool,\n  };\n\n  state = {\n    width: 323,\n  };\n\n  _load () {\n    const { accountId, isAccount, dispatch } = this.props;\n\n    if (!isAccount) dispatch(fetchAccount(accountId));\n    dispatch(expandAccountMediaTimeline(accountId));\n  }\n\n  componentDidMount () {\n    const { params: { acct }, accountId, dispatch } = this.props;\n\n    if (accountId) {\n      this._load();\n    } else {\n      dispatch(lookupAccount(acct));\n    }\n  }\n\n  componentDidUpdate (prevProps) {\n    const { params: { acct }, accountId, dispatch } = this.props;\n\n    if (prevProps.accountId !== accountId && accountId) {\n      this._load();\n    } else if (prevProps.params.acct !== acct) {\n      dispatch(lookupAccount(acct));\n    }\n  }\n\n  handleScrollToBottom = () => {\n    if (this.props.hasMore) {\n      this.handleLoadMore(this.props.attachments.size > 0 ? this.props.attachments.last().getIn(['status', 'id']) : undefined);\n    }\n  };\n\n  handleScroll = e => {\n    const { scrollTop, scrollHeight, clientHeight } = e.target;\n    const offset = scrollHeight - scrollTop - clientHeight;\n\n    if (150 > offset && !this.props.isLoading) {\n      this.handleScrollToBottom();\n    }\n  };\n\n  handleLoadMore = maxId => {\n    this.props.dispatch(expandAccountMediaTimeline(this.props.accountId, { maxId }));\n  };\n\n  handleLoadOlder = e => {\n    e.preventDefault();\n    this.handleScrollToBottom();\n  };\n\n  handleOpenMedia = attachment => {\n    const { dispatch } = this.props;\n    const statusId = attachment.getIn(['status', 'id']);\n    const lang = attachment.getIn(['status', 'language']);\n\n    if (attachment.get('type') === 'video') {\n      dispatch(openModal({\n        modalType: 'VIDEO',\n        modalProps: { media: attachment, statusId, lang, options: { autoPlay: true } },\n      }));\n    } else if (attachment.get('type') === 'audio') {\n      dispatch(openModal({\n        modalType: 'AUDIO',\n        modalProps: { media: attachment, statusId, lang, options: { autoPlay: true } },\n      }));\n    } else {\n      const media = attachment.getIn(['status', 'media_attachments']);\n      const index = media.findIndex(x => x.get('id') === attachment.get('id'));\n\n      dispatch(openModal({\n        modalType: 'MEDIA',\n        modalProps: { media, index, statusId, lang },\n      }));\n    }\n  };\n\n  handleRef = c => {\n    if (c) {\n      this.setState({ width: c.offsetWidth });\n    }\n  };\n\n  render () {\n    const { attachments, isLoading, hasMore, isAccount, multiColumn, blockedBy, suspended } = this.props;\n    const { width } = this.state;\n\n    if (!isAccount) {\n      return (\n        <BundleColumnError multiColumn={multiColumn} errorType='routing' />\n      );\n    }\n\n    if (!attachments && isLoading) {\n      return (\n        <Column>\n          <LoadingIndicator />\n        </Column>\n      );\n    }\n\n    let loadOlder = null;\n\n    if (hasMore && !(isLoading && attachments.size === 0)) {\n      loadOlder = <LoadMore visible={!isLoading} onClick={this.handleLoadOlder} />;\n    }\n\n    let emptyMessage;\n\n    if (suspended) {\n      emptyMessage = <FormattedMessage id='empty_column.account_suspended' defaultMessage='Account suspended' />;\n    } else if (blockedBy) {\n      emptyMessage = <FormattedMessage id='empty_column.account_unavailable' defaultMessage='Profile unavailable' />;\n    }\n\n    return (\n      <Column>\n        <ColumnBackButton />\n\n        <ScrollContainer scrollKey='account_gallery'>\n          <div className='scrollable scrollable--flex' onScroll={this.handleScroll}>\n            <HeaderContainer accountId={this.props.accountId} />\n\n            {(suspended || blockedBy) ? (\n              <div className='empty-column-indicator'>\n                {emptyMessage}\n              </div>\n            ) : (\n              <div role='feed' className='account-gallery__container' ref={this.handleRef}>\n                {attachments.map((attachment, index) => attachment === null ? (\n                  <LoadMoreMedia key={'more:' + attachments.getIn(index + 1, 'id')} maxId={index > 0 ? attachments.getIn(index - 1, 'id') : null} onLoadMore={this.handleLoadMore} />\n                ) : (\n                  <MediaItem key={attachment.get('id')} attachment={attachment} displayWidth={width} onOpenMedia={this.handleOpenMedia} />\n                ))}\n\n                {loadOlder}\n              </div>\n            )}\n\n            {isLoading && attachments.size === 0 && (\n              <div className='scrollable__append'>\n                <LoadingIndicator />\n              </div>\n            )}\n          </div>\n        </ScrollContainer>\n      </Column>\n    );\n  }\n\n}\n\nexport default connect(mapStateToProps)(AccountGallery);\n"],"sourceRoot":""}